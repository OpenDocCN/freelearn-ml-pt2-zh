<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Clustering World Happiness</h1>
                </header>
            
            <article>
                
<p>In the final chapter of this book, we will look at utilizing ensemble cluster analysis in order to explore relationships in reported happiness around the world. In order to do so, we will leverage the <kbd>OpenEnsembles</kbd> library. First, we will present the data and its purpose. We will then construct our ensemble. Finally, we will try to gain more knowledge about structures and relationships within our data.</p>
<p>The following are the topics that we will cover in this <span>chapter</span>:</p>
<ul>
<li>Understanding the <span>World Happiness Report</span></li>
<li>Creating the ensemble</li>
<li>Gaining insights</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Technical requirements</h1>
                </header>
            
            <article>
                
<p>You will require basic knowledge of machine learning techniques and algorithms. Furthermore, a knowledge of python conventions and syntax is required. Finally, familiarity with the NumPy library will greatly help the reader to understand some custom algorithm implementations.</p>
<p>The code files of this chapter can be found on GitHub:</p>
<p><a href="https://github.com/PacktPublishing/Hands-On-Ensemble-Learning-with-Python/tree/master/Chapter13">https://github.com/PacktPublishing/Hands-On-Ensemble-Learning-with-Python/tree/master/Chapter13</a></p>
<p>Check out the following video to see the Code in Action: <a href="http://bit.ly/2ShFsUm">http://bit.ly/2ShFsUm</a><a href="http://bit.ly/2ShFsUm">.</a></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Understanding the World Happiness Report</h1>
                </header>
            
            <article>
                
<p>The <span>World Happiness Report</span> is a survey of happiness in individual countries. It started from a United Nations meeting about well-being and happiness around the world. The survey generates happiness rankings using data from the Gallup World Poll, where people rate their overall quality<span> of life</span> (the variable containing the evaluations is the life ladder variable). The data can be found on the <em>World Happiness Report</em> website under the downloads section (<a href="https://worldhappiness.report/ed/2019/">https://worldhappiness.report/ed/2019/</a>). Apart from <span>the </span>Life Ladder, the dataset also contains a number of other factors. <span>The ones we will focus on are as follows</span>:</p>
<ul>
<li>Log GDP per capita</li>
<li>Social support</li>
<li>Healthy life expectancy at birth</li>
<li>Freedom to make life choices</li>
<li>Generosity</li>
<li>Perceptions of corruption</li>
<li>Positive affect (average of happiness, laughter, and enjoyment)</li>
<li>Negative affect (average of worry, sadness, and anger)</li>
<li>Confidence in national government</li>
<li>Democratic quality (how democratic the government is)</li>
<li>Delivery quality (how effective the government is)</li>
</ul>
<p>We can see how each one of these factors affects the life ladder by examining them on scatter plots. The following diagram depicts the scatter plots between each factor (<em>x </em>axis) and the life ladder (<em>y </em>axis):</p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-692 image-border" src="assets/7c0d8594-7580-42ab-bddd-530886923610.png" style="width:36.58em;height:41.00em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Scatter plots of the various factors against the Life Ladder</div>
<p>As is evident, <strong>Log GDP per capita</strong> and <strong>Healthy life expectancy at birth</strong> have the strongest positive and linear correlations with the life ladder. <strong>Democratic quality</strong>, <strong>Delivery quality</strong>, <strong>Freedom to make life choices</strong>, <strong>Positive affect</strong>, and <strong>Social support</strong> also exhibit positive correlations to the life ladder. <strong>Negative affect</strong> and <strong>Perceptions of corruption</strong> show negative correlations, while <strong>Confidence in national government</strong> does not indicate any significant correlation. By examining the Pearson's <strong>correlation coefficient</strong> (<strong>r</strong>) of each factor to the Life Ladder, we are able to confirm our visual findings:</p>
<table border="1" style="border-collapse: collapse;width: 100%">
<tbody>
<tr>
<td class="CDPAlignCenter CDPAlign">
<p><strong>Factor</strong></p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p><strong>Correlation coefficient</strong> (<strong>r</strong>)</p>
</td>
</tr>
<tr>
<td class="CDPAlignCenter CDPAlign">
<p>Log GDP per capita</p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p>0.779064</p>
</td>
</tr>
<tr>
<td class="CDPAlignCenter CDPAlign">
<p>Social support</p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p>0.702461</p>
</td>
</tr>
<tr>
<td class="CDPAlignCenter CDPAlign">
<p>Healthy life expectancy at birth</p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p>0.736797</p>
</td>
</tr>
<tr>
<td class="CDPAlignCenter CDPAlign">
<p>Freedom to make life choices</p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p>0.520988</p>
</td>
</tr>
<tr>
<td class="CDPAlignCenter CDPAlign">
<p>Generosity</p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p>0.197423</p>
</td>
</tr>
<tr>
<td class="CDPAlignCenter CDPAlign">
<p>Perceptions of corruption</p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p>-0.42075</p>
</td>
</tr>
<tr>
<td class="CDPAlignCenter CDPAlign">
<p>Positive affect</p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p>0.543377</p>
</td>
</tr>
<tr>
<td class="CDPAlignCenter CDPAlign">
<p>Negative affect</p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p>-0.27933</p>
</td>
</tr>
<tr>
<td class="CDPAlignCenter CDPAlign">
<p>Confidence in national government</p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p>-0.09205</p>
</td>
</tr>
<tr>
<td class="CDPAlignCenter CDPAlign">
<p>Democratic quality</p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p>0.614572</p>
</td>
</tr>
<tr>
<td class="CDPAlignCenter CDPAlign">
<p>Delivery quality</p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p>0.70794</p>
</td>
</tr>
</tbody>
</table>
<div class="CDPAlignCenter CDPAlign packt_figref"><span>Correlation coefficient of each factor to the life ladder</span></div>
<p>Over the years, a total of 165 individual countries have been studied. The countries are organized in 10 different regions, according to their geographic location. The distribution of countries to each region for the latest report can be seen in the following pie chart. As<span> is evident,</span> Sub-Saharan Africa, Western Europe, and Central and Eastern Europe contain the most countries. This does not imply that these regions have the highest populations. It simply implies that these regions have the greatest number of separate countries:</p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-693 image-border" src="assets/9506ce4b-c362-4db7-9b16-858aa179399d.png" style="width:36.33em;height:17.42em;"/></p>
<div class="CDPAlignCenter CDPAlign packt_figref">Distribution of countries to each region for 2018</div>
<p class="mce-root">Finally, it would be interesting to see how the Life Ladder progresses throughout the years. The following boxplot shows the Life Ladder's progression from 2005 to 2018. What we notice is that 2005 was a year with exceedingly high scores, while all other years are approximately the same. Given that there is not a global event that may explain this anomaly, we assume that something in the data collection process has influenced it:</p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-694 image-border" src="assets/a4eabdb3-3827-42fc-938c-9f180718c25a.png" style="width:33.58em;height:25.08em;"/></p>
<div class="CDPAlignCenter CDPAlign packt_figref">Boxplots of the Life Ladder for the various years</div>
<div>
<p>Indeed, if we examine the number of countries surveyed each year, we can see that 2005 has a very small number of countries compared to other years. There are only 27 countries for 2005, while 2006 has 89 countries. The number continues to increase up until 2011, when it stabilizes:</p>
</div>
<table border="1" style="border-collapse: collapse;width: 100%">
<tbody>
<tr>
<td class="CDPAlignCenter CDPAlign">
<p><strong>Year</strong></p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p><strong>Number of countries</strong></p>
</td>
</tr>
<tr>
<td class="CDPAlignCenter CDPAlign">
<p>2005</p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p>27</p>
</td>
</tr>
<tr>
<td class="CDPAlignCenter CDPAlign">
<p>2006</p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p>89</p>
</td>
</tr>
<tr>
<td class="CDPAlignCenter CDPAlign">
<p>2007</p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p>102</p>
</td>
</tr>
<tr>
<td class="CDPAlignCenter CDPAlign">
<p>2008</p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p>110</p>
</td>
</tr>
<tr>
<td class="CDPAlignCenter CDPAlign">
<p>2009</p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p>114</p>
</td>
</tr>
<tr>
<td class="CDPAlignCenter CDPAlign">
<p>2010</p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p>124</p>
</td>
</tr>
<tr>
<td class="CDPAlignCenter CDPAlign">
<p>2011</p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p>146</p>
</td>
</tr>
<tr>
<td class="CDPAlignCenter CDPAlign">
<p>2012</p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p>142</p>
</td>
</tr>
<tr>
<td class="CDPAlignCenter CDPAlign">
<p>2013</p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p>137</p>
</td>
</tr>
<tr>
<td class="CDPAlignCenter CDPAlign">
<p>2014</p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p>145</p>
</td>
</tr>
<tr>
<td class="CDPAlignCenter CDPAlign">
<p>2015</p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p>143</p>
</td>
</tr>
<tr>
<td class="CDPAlignCenter CDPAlign">
<p>2016</p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p>142</p>
</td>
</tr>
<tr>
<td class="CDPAlignCenter CDPAlign">
<p>2017</p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p>147</p>
</td>
</tr>
<tr>
<td class="CDPAlignCenter CDPAlign">
<p>2018</p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p>136</p>
</td>
</tr>
</tbody>
</table>
<div class="CDPAlignCenter CDPAlign packt_figref"><span>Number of countries surveyed each year</span></div>
<p>If we only consider the initial 27 countries, the boxplots show the expected outcome. There are some fluctuations in the mean and deviation results; however, on average, the life ladder values are distributed around the same values. Furthermore, if we compare the average values with those of the previous boxplot, we see that, <span>on average, </span>these 27 countries are happier than the rest of the countries that were later add<span>e</span><span>d to the dataset:</span></p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-695 image-border" src="assets/cbabf372-cbb2-4821-8b4b-68b2cb524369.png" style="width:33.92em;height:25.33em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Boxplots for just the 27 countries that were part of the original 2005 dataset</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating the ensemble</h1>
                </header>
            
            <article>
                
<p>In order to create the ensemble, we will utilize the <kbd>openensembles</kbd> library that we presented in <a href="https://cdp.packtpub.com/hands_on_ensemble_learning_with_python/wp-admin/post.php?post=36&amp;action=edit#post_31">Chapter 8</a><span>, </span><em>Clustering</em>. As our dataset does not contain labels, we cannot use the homogeneity score in order to evaluate our clustering models. Instead, we will use the silhouette score, which evaluates how cohesive each cluster is and how separate different clusters are. First, we must load our dataset, which is provided in the <kbd>WHR.csv</kbd> file. The second file that we load, <kbd>Regions.csv</kbd>, contains the region that each country belongs to. We will utilize the data from 2017, as 2018 has a lot of missing data (<span>for example, <strong>D</strong></span><strong>elivery quality</strong> and <strong>Democratic quality</strong> are completely absent). We will fill any missing data using the median of the dataset. For our experiment, we will utilize the factors we presented earlier. We store them in the <kbd>columns</kbd> variable, for ease of reference. We then proceed to generate the OpenEnsembles <kbd>data</kbd> object:</p>
<pre>import matplotlib.pyplot as plt<br/>import numpy as np<br/>import openensembles as oe <br/>import pandas as pd<br/><br/>from sklearn import metrics<br/><br/># Load the datasets<br/>data = pd.read_csv('WHR.csv')<br/>regs = pd.read_csv('Regions.csv')<br/><br/># DATA LOADING SECTION START #<br/># Use the 2017 data and fill any NaNs<br/>recents = data[data.Year == 2017]<br/>recents = recents.dropna(axis=1, how="all")<br/>recents = recents.fillna(recents.median())<br/><br/># Use only these specific features<br/>columns = ['Log GDP per capita',<br/> 'Social support', 'Healthy life expectancy at birth',<br/> 'Freedom to make life choices', 'Generosity',<br/> 'Perceptions of corruption','Positive affect', 'Negative affect',<br/> 'Confidence in national government', 'Democratic Quality',<br/> 'Delivery Quality']<br/><br/># Create the data object<br/>cluster_data = oe.data(recents[columns], columns)<br/># DATA LOADING SECTION END #</pre>
<p>In order to create our K-means ensemble, we will test a number of <em>K</em> values and a number of ensemble sizes. We will test <em>K</em> values of 2, 4, 6, 8, 10, 12, and 14, and ensembles of size 5, 10, 20, and 50. In order to combine the individual base clusters, we will utilize co-occurrence linkage, as this was the most stable out of the three algorithms in <a href="f6899a7f-8345-4d8f-8b74-f88ede323e5e.xhtml"/><a href="f6899a7f-8345-4d8f-8b74-f88ede323e5e.xhtml">Chapter 8</a>, <em>Clustering</em>. We will store the results in the results dictionary, in order to process them later. Finally, we will create a pandas DataFrame from the results dictionary and arrange it in a two-dimensional array, in which each row corresponds to a certain <em>K</em> value and each column <span>corresponds </span>to a certain ensemble size:</p>
<pre>np.random.seed(123456)<br/>results = {'K':[], 'size':[], 'silhouette': []}<br/># Test different ensemble setups<br/>Ks = [2, 4, 6, 8, 10, 12, 14]<br/>sizes = [5, 10, 20, 50]<br/>for K in Ks:<br/>    for ensemble_size in sizes:<br/>        ensemble = oe.cluster(cluster_data)<br/>        for i in range(ensemble_size):<br/>            name = f'kmeans_{ensemble_size}_{i}'<br/>            ensemble.cluster('parent', 'kmeans', name, K)<br/><br/>        preds = ensemble.finish_co_occ_linkage(threshold=0.5)<br/>        print(f'K: {K}, size {ensemble_size}:', end=' ')<br/>        silhouette = metrics.silhouette_score(recents[columns], <br/>        preds.labels['co_occ_linkage'])<br/>        print('%.2f' % silhouette)<br/>        results['K'].append(K)<br/>        results['size'].append(ensemble_size)<br/>        results['silhouette'].append(silhouette)<br/> <br/>results_df = pd.DataFrame(results)<br/>cross = pd.crosstab(results_df.K, results_df['size'], <br/>results_df['silhouette'], aggfunc=lambda x: x)</pre>
<p>The results are depicted in the following table. As is evident, the silhouette score decreases as <em>K</em> increases. Furthermore, there seems to be a certain stability for <em>K</em> values up to six. Still, our data was fed to the clustering ensemble without any preprocessing. Thus, the distance metric can be dominated by features whose values are greater than others:</p>
<table border="1" style="border-collapse: collapse;width: 100%">
<tbody>
<tr>
<td>
<p class="CDPAlignRight CDPAlign">Size</p>
<p><span>K</span></p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">5</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">10</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">20</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">50</p>
</td>
</tr>
<tr>
<td class="CDPAlignCenter CDPAlign">
<p class="CDPAlignCenter">2</p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p class="CDPAlignCenter">0.618</p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p class="CDPAlignCenter CDPAlign">0.618</p>
</td>
<td class="CDPAlignCenter CDPAlign">
<p class="CDPAlignCenter CDPAlign">0.618</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.618</p>
</td>
</tr>
<tr>
<td>
<p class="CDPAlignCenter CDPAlign">4</p>
</td>
<td>
<p class="CDPAlignCenter">0.533</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.533</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.533</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.533</p>
</td>
</tr>
<tr>
<td>
<p class="CDPAlignCenter CDPAlign">6</p>
</td>
<td>
<p class="CDPAlignCenter">0.475</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.475</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.475</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.475</p>
</td>
</tr>
<tr>
<td>
<p class="CDPAlignCenter CDPAlign">8</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.396</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.398</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.264</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.243</p>
</td>
</tr>
<tr>
<td>
<p class="CDPAlignCenter CDPAlign">10</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.329</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.248</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.282</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.287</p>
</td>
</tr>
<tr>
<td>
<p class="CDPAlignCenter CDPAlign">12</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.353</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.315</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.327</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.350</p>
</td>
</tr>
<tr>
<td>
<p class="CDPAlignCenter CDPAlign">14</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.333</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.309</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.343</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.317</p>
</td>
</tr>
</tbody>
</table>
<div class="packt_figref CDPAlignCenter CDPAlign"><span>Results from the experimentation of different K values and ensemble sizes</span></div>
<p>In order to exclude the possibility that some features dominate over others, we will repeat the experiment by using normalized features, as well as <strong>t-Distributed Stochastic Neighbor<span> Embedding</span></strong> (<strong>t<span>-</span>SNE</strong>) transformed features. First, we will test the normalized features. We must first subtract the mean and then divide by the standard deviation of each feature. This is easily achieved by using the standard pandas functions, as follows:</p>
<pre class="mce-root"># DATA LOADING SECTION START #<br/><br/># Use the 2017 data and fill any NaNs<br/>recents = data[data.Year == 2017]<br/>recents = recents.dropna(axis=1, how="all")<br/>recents = recents.fillna(recents.median())<br/><br/># Use only these specific features<br/>columns = ['Log GDP per capita',<br/> 'Social support', 'Healthy life expectancy at birth',<br/> 'Freedom to make life choices', 'Generosity',<br/> 'Perceptions of corruption','Positive affect', 'Negative affect',<br/> 'Confidence in national government', 'Democratic Quality',<br/> 'Delivery Quality']<br/><br/># Normalize the features by subtracting the mean<br/># and dividing by the standard deviation<br/>normalized = recents[columns]<br/>normalized = normalized - normalized.mean()<br/>normalized = normalized / normalized.std()<br/><br/># Create the data object<br/>cluster_data = oe.data(recents[columns], columns)<br/># DATA LOADING SECTION END #</pre>
<p>We then test the same <em>K</em> values and ensemble sizes. As the following table shows, the results are quite similar to the original experiment:</p>
<table border="1" style="border-collapse: collapse;width: 100%">
<tbody>
<tr>
<td>
<p class="CDPAlignRight CDPAlign">Size</p>
<p>K</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">5</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">10</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">20</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">50</p>
</td>
</tr>
<tr>
<td>
<p class="CDPAlignCenter CDPAlign">2</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.618</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.618</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.618</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.618</p>
</td>
</tr>
<tr>
<td>
<p class="CDPAlignCenter CDPAlign">4</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.533</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.533</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.533</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.533</p>
</td>
</tr>
<tr>
<td>
<p class="CDPAlignCenter CDPAlign">6</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.475</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.475</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.475</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.475</p>
</td>
</tr>
<tr>
<td>
<p class="CDPAlignCenter CDPAlign">8</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.393</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.396</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.344</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.264</p>
</td>
</tr>
<tr>
<td>
<p class="CDPAlignCenter CDPAlign">10</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.311</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.355</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.306</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.292</p>
</td>
</tr>
<tr>
<td>
<p class="CDPAlignCenter CDPAlign">12</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.346</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.319</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.350</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.350</p>
</td>
</tr>
<tr>
<td>
<p class="CDPAlignCenter CDPAlign">14</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.328</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.327</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.326</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.314</p>
</td>
</tr>
</tbody>
</table>
<div class="CDPAlignCenter CDPAlign packt_figref"><span>Silhouette scores for the normalized data</span></div>
<p>Finally, we repeat the experiment with t-SNE as a preprocessing step. First, we import t-<span>SNE</span> with <kbd>from sklearn.manifold import t_sne</kbd>. In order to preprocess the data, we call the <kbd>fit_transform</kbd> function of <kbd>TSNE</kbd>, as shown in the following code excerpt. Note that <kbd>oe.data</kbd> now has <kbd>[0, 1]</kbd> as column names, since t-<span>SNE,</span> by default, <span>only </span>creates two components. Thus, our data will have only two columns:</p>
<pre class="mce-root"># DATA LOADING SECTION START #<br/><br/># Use the 2017 data and fill any NaNs<br/>recents = data[data.Year == 2017]<br/>recents = recents.dropna(axis=1, how="all")<br/>recents = recents.fillna(recents.median())<br/><br/># Use only these specific features<br/>columns = ['Log GDP per capita',<br/> 'Social support', 'Healthy life expectancy at birth',<br/> 'Freedom to make life choices', 'Generosity',<br/> 'Perceptions of corruption','Positive affect', 'Negative affect',<br/> 'Confidence in national government', 'Democratic Quality',<br/> 'Delivery Quality']<br/><br/># Transform the data with TSNE<br/>tsne = t_sne.TSNE()<br/>transformed = pd.DataFrame(tsne.fit_transform(recents[columns]))<br/># Create the data object<br/>cluster_data = oe.data(transformed, [0, 1])<br/><br/># DATA LOADING SECTION END #</pre>
<p>The results are depicted in the following table. We can see that t-SNE outperforms the other two approaches for some values. We are especially interested in 10 as the <em>K</em> value, due to the fact that there are 10 regions in the dataset. In the next section, we will try to gain insights into the data, using a <em>K</em> value of 10 and an ensemble size of 20:</p>
<table border="1" style="border-collapse: collapse;width: 100%">
<tbody>
<tr>
<td>
<p class="CDPAlignRight CDPAlign">Size</p>
<p>K</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">5</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">10</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">20</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">50</p>
</td>
</tr>
<tr>
<td>
<p class="CDPAlignCenter CDPAlign">2</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.537</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.537</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.537</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.537</p>
</td>
</tr>
<tr>
<td>
<p class="CDPAlignCenter CDPAlign">4</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.466</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.466</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.466</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.466</p>
</td>
</tr>
<tr>
<td>
<p class="CDPAlignCenter CDPAlign">6</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.405</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.405</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.405</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.405</p>
</td>
</tr>
<tr>
<td>
<p class="CDPAlignCenter CDPAlign">8</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.343</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.351</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.351</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.351</p>
</td>
</tr>
<tr>
<td>
<p class="CDPAlignCenter CDPAlign">10</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.349</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.348</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.350</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.349</p>
</td>
</tr>
<tr>
<td>
<p class="CDPAlignCenter CDPAlign">12</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.282</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.288</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.291</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.288</p>
</td>
</tr>
<tr>
<td>
<p class="CDPAlignCenter CDPAlign">14</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.268</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.273</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.275</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.272</p>
</td>
</tr>
</tbody>
</table>
<div class="mce-root CDPAlignCenter CDPAlign packt_figref"><span>Silhouette scores for t-SNE transformed data</span></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Gaining insights</h1>
                </header>
            
            <article>
                
<p>In order to gain further insights into our dataset's structure and relationships, we will use the t-SNE approach, with ensembles of size 20 and base <strong><span>k-Nearest Neighbors</span></strong> (<strong>k-NN</strong>) clusterers with a <em>K</em> value of 10. First, we create and train the cluster. Then, we add the cluster assignments to the DataFrame <span>as an additional pandas column</span>. We then calculate the means for each cluster and create a bar plot for each feature:</p>
<pre class="mce-root"># DATA LOADING SECTION START #<br/><br/># Use the 2017 data and fill any NaNs<br/>recents = data[data.Year == 2017]<br/>recents = recents.dropna(axis=1, how="all")<br/>recents = recents.fillna(recents.median())<br/><br/># Use only these specific features<br/>columns = ['Log GDP per capita',<br/> 'Social support', 'Healthy life expectancy at birth',<br/> 'Freedom to make life choices', 'Generosity',<br/> 'Perceptions of corruption','Positive affect', 'Negative affect',<br/> 'Confidence in national government', 'Democratic Quality',<br/> 'Delivery Quality']<br/><br/># Transform the data with TSNE<br/>tsne = t_sne.TSNE()<br/>transformed = pd.DataFrame(tsne.fit_transform(recents[columns]))<br/># Create the data object<br/>cluster_data = oe.data(transformed, [0, 1])<br/><br/># DATA LOADING SECTION END #<br/><br/># Create the ensemble<br/>ensemble = oe.cluster(cluster_data)<br/>for i in range(20):<br/>    name = f'kmeans_{i}-tsne'<br/>    ensemble.cluster('parent', 'kmeans', name, 10)<br/><br/># Create the cluster labels<br/>preds = ensemble.finish_co_occ_linkage(threshold=0.5)<br/><br/># Add Life Ladder to columns<br/>columns = ['Life Ladder', 'Log GDP per capita',<br/> 'Social support', 'Healthy life expectancy at birth',<br/> 'Freedom to make life choices', 'Generosity',<br/> 'Perceptions of corruption','Positive affect', 'Negative affect',<br/> 'Confidence in national government', 'Democratic Quality',<br/> 'Delivery Quality']<br/># Add the cluster to the dataframe and group by the cluster<br/>recents['Cluster'] = preds.labels['co_occ_linkage']<br/>grouped = recents.groupby('Cluster')<br/># Get the means<br/>means = grouped.mean()[columns]<br/># Create barplots<br/>def create_bar(col, nc, nr, index):<br/>    plt.subplot(nc, nr, index)    <br/>    values = means.sort_values('Life Ladder')[col]<br/>    mn = min(values) * 0.98<br/>    mx = max(values) * 1.02<br/>    values.plot(kind='bar', ylim=[mn, mx])<br/>    plt.title(col[:18])<br/> <br/># Plot for each feature<br/>plt.figure(1)<br/>i = 1<br/>for col in columns:<br/>    create_bar(col, 4, 3, i)<br/>    i += 1<br/>plt.show()</pre>
<p>The bar plots are depicted in the following diagram. The clusters are sorted according to their average Life Ladder value, in order to easily make comparisons between the individual features. As we can see, clusters 3, 2, and 4 have comparable average happiness (Life Ladder). The same can be said for clusters 6, 8, 9, 7, and 5. We could argue that the ensemble only needs 5 clusters, but, by closely examining the other features, we see that this is not the case:</p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-696 image-border" src="assets/38ed8d6d-379a-4095-afaf-5df1b596882f.png" style="width:39.33em;height:29.50em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Bar plots of cluster means for each feature</div>
<p>By looking at <em>Healthy life expectancy</em> and <em>Freedom to make life choices</em>, we see that clusters 3 and 4 are considerably better than 2. In fact, if we examine every other feature, we see that clusters 3 and 4 are, on average, more fortunate  than cluster 2. Maybe it is interesting to see how the individual countries are distributed among each cluster. The following table depicts the cluster assignments. Indeed, we see that clusters 2, 3, and 4 involve countries that have had to recently overcome difficulties that were not captured in our features. In fact, these are some of the most war-torn areas of the world. From a sociological point of view, it is <span>extremely interesting that</span> these war-torn and troubled regions seem to have the most confidence in their governments, despite exhibiting extremely negative democratic and delivery qualities:</p>
<table border="1" style="border-collapse: collapse;width: 100%">
<tbody>
<tr>
<td class="CDPAlignCenter CDPAlign" style="width: 6.69597%">
<p><strong>N</strong></p>
</td>
<td class="CDPAlignCenter CDPAlign" style="width: 92.6104%">
<p><strong>Countries</strong></p>
</td>
</tr>
<tr>
<td class="CDPAlignCenter CDPAlign" style="width: 6.69597%">
<p>1</p>
</td>
<td class="CDPAlignCenter CDPAlign" style="width: 92.6104%">
<p>Cambodia, Egypt, Indonesia, Libya, Mongolia, Nepal, Philippines, and Turkmenistan</p>
</td>
</tr>
<tr>
<td class="CDPAlignCenter CDPAlign" style="width: 6.69597%">
<p>2</p>
</td>
<td class="CDPAlignCenter CDPAlign" style="width: 92.6104%">
<p>Afghanistan, Burkina Faso, Cameroon, Central African Republic, Chad, Congo (Kinshasa), Guinea, Ivory Coast, Lesotho, Mali, Mozambique, Niger, Nigeria, Sierra Leone, and South Sudan</p>
</td>
</tr>
<tr>
<td class="CDPAlignCenter CDPAlign" style="width: 6.69597%">
<p>3</p>
</td>
<td class="CDPAlignCenter CDPAlign" style="width: 92.6104%">
<p>Benin, Gambia, Ghana, Haiti, Liberia, Malawi, Mauritania, Namibia, South Africa, Tanzania, Togo, Uganda, Yemen, Zambia, and Zimbabwe</p>
</td>
</tr>
<tr>
<td class="CDPAlignCenter CDPAlign" style="width: 6.69597%">
<p>4</p>
</td>
<td class="CDPAlignCenter CDPAlign" style="width: 92.6104%">
<p>Botswana, Congo (Brazzaville), Ethiopia, Gabon, India, Iraq, Kenya, Laos, Madagascar, Myanmar, Pakistan, Rwanda, and Senegal</p>
</td>
</tr>
<tr>
<td class="CDPAlignCenter CDPAlign" style="width: 6.69597%">
<p>5</p>
</td>
<td class="CDPAlignCenter CDPAlign" style="width: 92.6104%">
<p>Albania, Argentina, Bahrain, Chile, China, Croatia, Czech Republic, Estonia, Montenegro, Panama, Poland, Slovakia, United States, and Uruguay</p>
</td>
</tr>
<tr>
<td class="CDPAlignCenter CDPAlign" style="width: 6.69597%">
<p>6</p>
</td>
<td class="CDPAlignCenter CDPAlign" style="width: 92.6104%">
<p>Algeria, Azerbaijan, Belarus, Brazil, Dominican Republic, El Salvador, Iran, Lebanon, Morocco, Palestinian Territories, Paraguay, Saudi Arabia, Turkey, and Venezuela</p>
</td>
</tr>
<tr>
<td class="CDPAlignCenter CDPAlign" style="width: 6.69597%">
<p>7</p>
</td>
<td class="CDPAlignCenter CDPAlign" style="width: 92.6104%">
<p>Bulgaria, Hungary, Kuwait, Latvia, Lithuania, Mauritius, Romania, Taiwan Province of China</p>
</td>
</tr>
<tr>
<td class="CDPAlignCenter CDPAlign" style="width: 6.69597%">
<p>8</p>
</td>
<td class="CDPAlignCenter CDPAlign" style="width: 92.6104%">
<p>Armenia, Bosnia and Herzegovina, Colombia, Ecuador, Honduras, Jamaica, Jordan, Macedonia, Mexico, Nicaragua, Peru, Serbia, Sri Lanka, Thailand, Tunisia, United Arab Emirates, and Vietnam</p>
</td>
</tr>
<tr>
<td class="CDPAlignCenter CDPAlign" style="width: 6.69597%">
<p>9</p>
</td>
<td class="CDPAlignCenter CDPAlign" style="width: 92.6104%">
<p>Bangladesh, Bolivia, Georgia, Guatemala, Kazakhstan, Kosovo, Kyrgyzstan, Moldova, Russia, Tajikistan, Trinidad and Tobago, Ukraine, and Uzbekistan</p>
</td>
</tr>
<tr>
<td class="CDPAlignCenter CDPAlign" style="width: 6.69597%">
<p>10</p>
</td>
<td class="CDPAlignCenter CDPAlign" style="width: 92.6104%">
<p>Australia, Austria, Belgium, Canada, Costa Rica, Cyprus, Denmark, Finland, France, Germany, Greece, Hong Kong S.A.R. of China, Iceland, Ireland, Israel, Italy, Japan, Luxembourg, Malta, Netherlands, New Zealand, Norway, Portugal, Singapore, Slovenia, South Korea, Spain, Sweden, Switzerland, and United Kingdom</p>
</td>
</tr>
</tbody>
</table>
<div class="CDPAlignCenter CDPAlign packt_figref"><span>Cluster assignments</span></div>
<p>Starting with to cluster 1, we see that the happiness of people in these countries is considerably better than the previous clusters. This can be attributed to a better life expectancy (less wars), better GDP per capita, social support, generosity, and freedom to make<span> choices regarding</span> life changes. Still, these countries are not as happy as they could be, mainly due to problems with democratic quality and delivery quality. Nonetheless, their confidence in their governments are second only to the previous group of clusters we discussed. Clusters 6, 8, and 9 are more or less on the same level of happiness. Their differences are in GDP per capita, life expectancy, freedom, generosity, and confidence. We can see that cluster 6 has, on average, stronger economies and life expectancy, although people's freedom, generosity, and the government's efficiency seem to be lacking. Clusters 8 and 9 are less economically sound, but seem to have a lot more freedom and better functioning governments. Moreover, their generosity, on average, is greater than cluster 6. Moving on to clusters 7 and 5, we see that they, too, are close in terms of happiness. These are countries where we see a positive democratic and delivery quality, with sufficient freedom, economic strength, social support, and a healthy life expectancy. These are developed countries, where people, on average, live a prosperous life without fear of dying from economic, political, or military causes. The problems in these countries are mainly the perception of corruption, people's confidence in their governments, and the efficiency of the governments. Finally, cluster 10 contains countries that are better in almost every aspect, compared to the rest of the world. These countries have, on average, the highest GDP per capita, life expectancy, generosity, and freedom, while having sufficiently high confidence in their national governments and low perceptions of corruption. These could be considered the ideal countries to live in, given a compatible cultural background.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, we presented the World Happiness Report data, providing a description of the data's purpose, as well as describing the data's properties. In order to gain further insights into the data, we utilized cluster analysis, leveraging ensemble techniques. We used co-occurrence matrix linkage in order to combine the cluster assignments of different base clusters. We tested various setups, with different ensemble sizes and numbers of neighbors, in order to provide a k-NN ensemble. After identifying that a t-SNE decomposition with a <em>K</em> value of 10 and 20 base clusters can be utilized, we analyzed the cluster assignments. We found that countries reporting the same happiness levels can, in fact, have different profiles. The most unhappy countries were, on average, developing countries who have to overcome many problems, concerning both their economies, and, in certain cases, wars. It is interesting that these countries had the most confidence in their governments, although these same governments are reported as dysfunctional. Countries that belong to clusters of medium happiness have either strong economies, but little freedom, or vice versa.</p>
<p>Developed countries with strong economies and life quality, but who perceive their governments as corrupt, are not able to achieve the highest happiness scores possible. Finally, the only countries that do not think their governments are corrupt have the strongest economies, democratic and delivery quality, and life expectancy. These are mostly countries in the European Union or the European Economic Area, along with Canada, Australia, New Zealand, Japan, South Korea, Costa Rica, Israel, Hong Kong, and Iceland.</p>
<p>In this book we have covered most ensemble learning techniques. After a short refresher on machine learning, we discussed about the main problems that arise from machine learning models. These problems are bias and variance. Ensemble learning techniques usually try to address these problems, through generative and non generative methods. We discussed both non-generative methods, such as Voting and Stacking, as well as generative methods, such as Bagging, Boosting, and Random Forests. Furthermore, we presented methods that can be utilized in order to create clustering ensembles, such as Majority Voting, Graph Closure, and Co-occurrence Linkage. Finally, we dedicated some chapters to specific applications, in order to show how some real-world problems should be handled. If there is a point that needs to be highlighted in this book, then it is that the data quality has a bigger impact on any particular model's performance than the algorithm used to create the model. Thus, ensemble learning techniques, such as any machine learning technique, should be used in order to address algorithmic weaknesses (of previously generated models) rather than poor data quality.</p>


            </article>

            
        </section>
    </body></html>