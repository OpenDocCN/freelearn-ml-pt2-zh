# 创建一个简单的估计器

在本章中，我们将涵盖以下几种方法：

+   创建一个简单的估计器

# 介绍

我们将使用 scikit-learn 创建一个自定义估计器。我们将传统的统计数学和编程转化为机器学习。你可以通过使用 scikit-learn 强大的交叉验证功能，将任何统计学方法转变为机器学习。

# 创建一个简单的估计器

我们将进行一些工作，构建我们自己的 scikit-learn 估计器。自定义的 scikit-learn 估计器至少包括三个方法：

+   一个 `__init__` 初始化方法：该方法接受估计器的参数作为输入

+   一个 `fit` 方法：该方法用于训练估计器

+   一个 `predict` 方法：该方法对未见过的数据进行预测

从图示来看，类大致如下：

[PRE0]

# 准备工作

从 scikit-learn 中加载乳腺癌数据集：

[PRE1]

将数据划分为训练集和测试集：

[PRE2]

# 如何实现...

一个 scikit 估计器应该有一个 `fit` 方法，该方法返回类本身，并且有一个 `predict` 方法，该方法返回预测结果：

1.  以下是我们称之为 `RidgeClassifier` 的分类器。导入 `BaseEstimator` 和 `ClassifierMixin`，并将它们作为参数传递给你的新分类器：

[PRE3]

让我们重点关注 `__init__` 方法。在这里，我们输入一个单一参数；它对应于底层岭回归器中的正则化参数。

在 `fit` 方法中，我们执行所有的工作。工作内容包括使用内部的岭回归器，并将类标签存储在数据中。如果类别超过两个，我们可能希望抛出一个错误，因为多个类别通常不能很好地映射到一组实数。在这个示例中，有两个可能的目标：恶性癌症或良性癌症。它们映射到实数，表示恶性程度，可以视为与良性相对立的度量。在鸢尾花数据集中，有 Setosa、Versicolor 和 Virginica 三种花。Setosaness 属性没有一个明确的对立面，除非以一对多的方式查看分类器。

在 `predict` 方法中，你会找到与岭回归器预测最接近的类标签。

1.  现在编写几行代码应用你的新岭回归分类器：

[PRE4]

1.  它在测试集上的表现相当不错。你也可以在其上执行网格搜索：

[PRE5]

# 它是如何工作的...

创建你自己的估计器的目的是让估计器继承 scikit-learn 基础估计器和分类器类的属性。在以下代码中：

[PRE6]

你的分类器查看了所有 scikit-learn 分类器的默认准确度评分。方便的是，你不需要去查找或实现它。此外，使用你的分类器时，过程与使用任何 scikit 分类器非常相似。

在以下示例中，我们使用逻辑回归分类器：

[PRE7]

你的新分类器比逻辑回归稍微好了一些。

# 还有更多...

有时，像Python的`statsmodels`或`rpy`（Python中的R接口）这样的统计包包含非常有趣的统计方法，你可能希望将它们通过scikit的交叉验证来验证。或者，你可以自己编写方法并希望对其进行交叉验证。

以下是一个使用`statsmodels`的**广义估计方程**（**GEE**）构建的自定义估计器，该方法可以在[http://www.statsmodels.org/dev/gee.html](http://www.statsmodels.org/dev/gee.html)找到。

GEE使用的是一般线性模型（借鉴了R），我们可以选择一个类似分组的变量，其中观察值在一个聚类内部可能相关，但跨聚类之间无关——根据文档的说法。因此，我们可以根据某个变量进行分组或聚类，并查看组内相关性。

在这里，我们根据R风格公式创建一个基于乳腺癌数据的模型：

[PRE8]

我们根据特征`mean_concavity`进行聚类（`mean_concavity`变量未包含在R风格公式中）。首先导入`statsmodels`模块的库。示例如下：

[PRE9]

`fit`方法中的代码与GEE文档中的代码类似。你可以根据自己的具体情况或统计方法来调整代码。`predict`方法中的代码与创建的岭回归分类器类似。

如果你像运行岭回归估计器那样运行代码：

[PRE10]

关键在于，你将一种传统的统计方法转变为机器学习方法，利用了scikit-learn的交叉验证。

# 尝试在皮马糖尿病数据集上使用新的GEE分类器

尝试在皮马糖尿病数据集上使用GEE分类器。加载数据集：

[PRE11]

将数据集分成训练集和测试集：

[PRE12]

使用GEE分类器进行预测。我们将使用`blood_pressure`列作为分组依据：

[PRE13]

你也可以尝试岭回归分类器：

[PRE14]

你可以将这些方法——岭回归分类器和GEE分类器——与[第5章](d2473ebe-f050-4e72-bbf9-fabe5d62d441.xhtml)中的逻辑回归进行比较，*线性模型 – 逻辑回归*。

# 保存你训练好的估计器

保存你的自定义估计器与保存任何scikit-learn估计器相同。按照以下方式将训练好的岭回归分类器保存到文件`rc_inst.save`中：

[PRE15]

要检索训练好的分类器并使用它，请执行以下操作：

[PRE16]

在scikit-learn中保存一个训练好的自定义估计器非常简单。
